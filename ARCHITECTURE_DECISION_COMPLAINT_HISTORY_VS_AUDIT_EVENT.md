# ูุฑุงุฑ ูุนูุงุฑู: ComplaintHistory vs AuditEvent
## Architecture Decision: Keep Both or Merge?

---

## ๐ ุงูุณุคุงู ุงูุฃุณุงุณู

ูู ูุฌุจ ุงูุงุญุชูุงุธ ุจู **ComplaintHistory** ู **AuditEvent** ูุนุงูุ ุฃู ุฏูุฌูุง ูู ุฌุฏูู ูุงุญุฏุ

---

## ๐ ุชุญููู ุงููุถุน ุงูุญุงูู

### ComplaintHistory (ููุฌูุฏ ูููุชูู)

**ุงูุบุฑุถ**: 
- ุชุชุจุน ุชุบููุฑุงุช ุงูุดูุงูู ููุท
- ุนุฑุถ timeline ููููุงุทู ูุงูููุธู
- ุชูุงุตูู ุฏูููุฉ ุนู ูู ุชุบููุฑ

**ุงูุฎุตุงุฆุต**:
```java
@Entity
public class ComplaintHistory {
    private Complaint complaint;           // ูุฑุชุจุท ูุจุงุดุฑุฉ ุจุงูุดููู
    private HistoryActionType actionType;  // ุฃููุงุน ุฎุงุตุฉ ุจุงูุดูุงูู
    private String fieldChanged;          // ุงูุญูู ุงูุฐู ุชุบูุฑ
    private String oldValue;              // ุงููููุฉ ุงููุฏููุฉ
    private String newValue;              // ุงููููุฉ ุงูุฌุฏูุฏุฉ
    private String metadata;              // JSON ูููุฑููุงุช
    private String actionDescription;     // ูุตู ุจุงูุนุฑุจูุฉ ูููุณุชุฎุฏู
}
```

**ุงูุงุณุชุฎุฏุงู ุงูุญุงูู**:
- โ `GET /api/v1/complaints/{id}/history` - ุนุฑุถ timeline ููููุงุทู/ุงูููุธู
- โ ุชุณุฌูู ุฌููุน ุชุบููุฑุงุช ุงูุดูุงูู (STATUS_CHANGED, ATTACHMENT_ADDED, etc.)
- โ ูุณุชุฎุฏู ูู ุงูุชูุงุฑูุฑ (ูุชูุณุท ุฒูู ุงูุฅุบูุงูุ ุงูุดูุงูู ุงููุชุฃุฎุฑุฉ)

**ููุงุท ุงูููุฉ**:
- โ ูุตูู ุฎุตูุตุงู ููุดูุงูู - ุญููู ูุฎุตุตุฉ
- โ ุชูุงุตูู ุฏูููุฉ (old/new values, field names)
- โ ูุตู ุจุงูุนุฑุจูุฉ ูููุณุชุฎุฏููู
- โ ูุฑุชุจุท ูุจุงุดุฑุฉ ุจู Complaint (ุณูููุฉ ุงูุงุณุชุนูุงู)
- โ ูุณุชุฎุฏู ูู UI ููููุงุทู ูุงูููุธู

---

### AuditEvent (ูุทููุจ ุฅุถุงูุชู)

**ุงูุบุฑุถ**:
- ุชุชุจุน ุฌููุน ุงูุนูููุงุช ูู ุงููุธุงู
- ูุฑุงูุจุฉ ุฃูููุฉ ูุชุฏููู ุนุงู
- ูููุดุฑู ุงูุนุงู ููุท

**ุงูุฎุตุงุฆุต ุงูููุชุฑุญุฉ**:
```java
@Entity
public class AuditEvent {
    private String action;        // CREATE_COMPLAINT, UPDATE_USER, LOGIN, etc.
    private String targetType;    // COMPLAINT, USER, EMPLOYEE, etc.
    private Long targetId;        // ID of target entity
    private User actor;           // ูู ูุงู ุจุงูุนูููุฉ
    private String status;        // SUCCESS, FAILURE
    private String details;       // JSON general details
    private String ipAddress;     // ููุฃูุงู
}
```

**ุงูุงุณุชุฎุฏุงู ุงููุทููุจ**:
- ๐ฒ `GET /api/v1/admin/audit-log` - ูููุดุฑู ุงูุนุงู ููุท
- ๐ฒ ุชุชุจุน ุนูููุงุช ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
- ๐ฒ ุชุชุจุน ุชุณุฌูู ุงูุฏุฎูู/ุงูุฎุฑูุฌ
- ๐ฒ ุชุชุจุน ุชุบููุฑ ุงูุตูุงุญูุงุช
- ๐ฒ ุชุตุฏูุฑ ููุชุฏููู

**ููุงุท ุงูููุฉ**:
- โ ุนุงู ูุฌููุน ุงูุนูููุงุช
- โ ูุฑุงูุจุฉ ุฃูููุฉ
- โ ุชุฏููู ูุธุงูู

---

## โ๏ธ ุงูููุงุฑูุฉ ุงูุชูุตูููุฉ

| ุงููุนูุงุฑ | ComplaintHistory | AuditEvent | ุงููุชูุฌุฉ |
|---------|------------------|------------|---------|
| **ุงููุทุงู** | ุงูุดูุงูู ููุท | ุฌููุน ุงูุนูููุงุช | ูุฎุชูู |
| **ุงููุณุชุฎุฏููู** | ุงูููุงุทูุ ุงูููุธูุ ุงููุดุฑู | ุงููุดุฑู ุงูุนุงู ููุท | ูุฎุชูู |
| **ุงูุชูุงุตูู** | ุฏูููุฉ ุฌุฏุงู (old/new values) | ุนุงูุฉ (JSON) | ูุฎุชูู |
| **ุงููุบุฉ** | ุนุฑุจูุฉ (actionDescription) | ุฅูุฌููุฒู (action) | ูุฎุชูู |
| **ุงูุงุณุชุนูุงูุงุช** | ูุฑุชุจุท ุจู Complaint ูุจุงุดุฑุฉ | ุนุงู (targetType + targetId) | ูุฎุชูู |
| **ุงูุฃุฏุงุก** | ูุญุณูู ููุดูุงูู | ุนุงู | ูุฎุชูู |
| **ุงูุบุฑุถ** | Timeline ูููุณุชุฎุฏููู | ุชุฏููู ุฃููู | ูุฎุชูู |

---

## ๐ฏ ุงูุฎูุงุฑุงุช ุงููุชุงุญุฉ

### ุงูุฎูุงุฑ 1: ุงูุงุญุชูุงุธ ุจูููููุง (Recommended) โญ

**ุงููุจุฑุฑุงุช**:

1. **ูุตู ุงูุงูุชูุงูุงุช (Separation of Concerns)**:
   - `ComplaintHistory`: Domain-specific ููุดูุงูู
   - `AuditEvent`: System-wide ููุชุฏููู

2. **ุฃุฏุงุก ุฃูุถู**:
   - `ComplaintHistory` ูุฑุชุจุท ูุจุงุดุฑุฉ ุจู Complaint (JOIN ุณุฑูุน)
   - `AuditEvent` ูููุตู (ูุง ูุคุซุฑ ุนูู queries ุงูุดูุงูู)

3. **ุงุณุชุฎุฏุงู ูุฎุชูู**:
   - `ComplaintHistory`: ูููุณุชุฎุฏููู ุงูุนุงุฏููู (timeline)
   - `AuditEvent`: ูููุดุฑู ุงูุนุงู (ุชุฏููู ุฃููู)

4. **ูููู ูุฎุชูู**:
   - `ComplaintHistory`: ุญููู ูุฎุตุตุฉ (fieldChanged, oldValue, newValue)
   - `AuditEvent`: ุนุงู (details JSON)

5. **ูุง ููุฌุฏ ุชูุฑุงุฑ ุญูููู**:
   - `ComplaintHistory` ูุณุฌู **ุชูุงุตูู ุงูุชุบููุฑุงุช** (ูุงุฐุง ุชุบูุฑ)
   - `AuditEvent` ูุณุฌู **ุงูุนูููุงุช** (ูุงุฐุง ุญุฏุซ)

**ุงููุซุงู**:
```java
// ComplaintHistory: ุชูุงุตูู ุฏูููุฉ
{
    complaint: Complaint#123,
    actionType: STATUS_CHANGED,
    fieldChanged: "status",
    oldValue: "PENDING",
    newValue: "IN_PROGRESS",
    actionDescription: "ุชู ุชุบููุฑ ุญุงูุฉ ุงูุดููู ูู 'ุฌุฏูุฏุฉ' ุฅูู 'ููุฏ ุงููุนุงูุฌุฉ'"
}

// AuditEvent: ุณุฌู ุนุงู
{
    action: "UPDATE_COMPLAINT",
    targetType: "COMPLAINT",
    targetId: 123,
    status: "SUCCESS",
    details: "{\"statusChanged\": true}"
}
```

**ุงูููุงุฆุฏ**:
- โ ูุตู ูุงุถุญ ููุงูุชูุงูุงุช
- โ ุฃุฏุงุก ุฃูุถู (queries ูุญุณููุฉ)
- โ ุณูููุฉ ุงูุตูุงูุฉ
- โ ูุฑููุฉ ุฃูุจุฑ

**ุงูุนููุจ**:
- โ๏ธ ุฌุฏููุงู ุจุฏูุงู ูู ูุงุญุฏ (ููู ูุฐุง ููุจูู)

---

### ุงูุฎูุงุฑ 2: ุฏูุฌูุง ูู AuditEvent ููุท

**ุงููุดุงูู**:

1. **ููุฏุงู ุงูุชูุงุตูู**:
   - `ComplaintHistory` ูุญุชูู ุนูู ุญููู ูุฎุตุตุฉ (fieldChanged, oldValue, newValue)
   - `AuditEvent` ูุณุชุฎุฏู JSON ููุท (ุฃูู ุฏูุฉ)

2. **ุงุณุชุนูุงูุงุช ูุนูุฏุฉ**:
   - ููุจุญุซ ุนู ุชุบููุฑุงุช ุดููู ูุนููุฉ: `WHERE targetType = 'COMPLAINT' AND targetId = ?`
   - ุฃุจุทุฃ ูู `WHERE complaint_id = ?`

3. **ููุฏุงู ุงููุธุงุฆู ุงููุฎุตุตุฉ**:
   - `actionDescription` ุจุงูุนุฑุจูุฉ ูููุณุชุฎุฏููู
   - `HistoryActionType` enum ุฎุงุต ุจุงูุดูุงูู

4. **ูุดุงูู ุงูุฃุฏุงุก**:
   - ุฌุฏูู ูุงุญุฏ ูุจูุฑ ูุฌููุน ุงูุนูููุงุช
   - Indexes ุฃูู ูุนุงููุฉ

**ุงููุชูุฌุฉ**: โ **ุบูุฑ ููุตู ุจู**

---

### ุงูุฎูุงุฑ 3: ุฏูุฌูุง ูู ComplaintHistory ููุท

**ุงููุดุงูู**:

1. **ุฎุงุฑุฌ ุงููุทุงู**:
   - `ComplaintHistory` ูุฎุตุต ููุดูุงูู ููุท
   - ูุง ูููู ุงุณุชุฎุฏุงูู ูุชุชุจุน ุนูููุงุช ุงููุณุชุฎุฏูููุ ุชุณุฌูู ุงูุฏุฎููุ ุฅูุฎ

2. **ูููู ุบูุฑ ููุงุณุจ**:
   - ุญููู ูุซู `fieldChanged`, `oldValue`, `newValue` ูุง ูุนูู ููุง ูุนูููุงุช ุฃุฎุฑู
   - `HistoryActionType` enum ุฎุงุต ุจุงูุดูุงูู

**ุงููุชูุฌุฉ**: โ **ุบูุฑ ูููู**

---

## โ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ: **ุงูุงุญุชูุงุธ ุจูููููุง**

### ุงููุจุฑุฑุงุช ุงูุฑุฆูุณูุฉ:

1. **ูุตู ุงูุงูุชูุงูุงุช (Separation of Concerns)**:
   ```
   ComplaintHistory  โ  Domain Model (Business Logic)
   AuditEvent        โ  Cross-cutting Concern (Security & Compliance)
   ```

2. **ุงุณุชุฎุฏุงู ูุฎุชูู**:
   - `ComplaintHistory`: **User-facing** (timeline ููููุงุทู/ุงูููุธู)
   - `AuditEvent`: **Admin-facing** (ุชุฏููู ุฃููู ูููุดุฑู)

3. **ูููู ูุฎุชูู**:
   - `ComplaintHistory`: ุญููู ูุฎุตุตุฉ ููุดูุงูู
   - `AuditEvent`: ูููู ุนุงู

4. **ุฃุฏุงุก ุฃูุถู**:
   - ูู ุฌุฏูู ูุญุณูู ูุงุณุชุฎุฏุงูู ุงูุฎุงุต
   - Indexes ูููุตูุฉ ููุญุณููุฉ

5. **ูุง ููุฌุฏ ุชูุฑุงุฑ ุญูููู**:
   - `ComplaintHistory`: **ูุงุฐุง ุชุบูุฑ** ูู ุงูุดููู (ุชูุงุตูู)
   - `AuditEvent`: **ูุงุฐุง ุญุฏุซ** ูู ุงููุธุงู (ุนูููุงุช)

---

## ๐ ุงูุชูุงูู ุจููููุง

### ุงูุณููุงุฑูู: ุนูุฏ ุชุญุฏูุซ ุดููู

```java
@Audited(action = "UPDATE_COMPLAINT", targetType = "COMPLAINT")
public ComplaintDTOResponse updateComplaint(...) {
    // 1. ComplaintHistory: ุชุณุฌูู ุชูุงุตูู ุงูุชุบููุฑ
    complaintHistoryService.recordFieldUpdate(
        complaint, user, "description", oldDesc, newDesc
    );
    
    // 2. AuditEvent: ุชุณุฌูู ุงูุนูููุฉ (ูุชู ุชููุงุฆูุงู ุนุจุฑ @Audited)
    // auditService.record("UPDATE_COMPLAINT", "COMPLAINT", complaintId, "SUCCESS", details);
    
    return result;
}
```

**ุงููุชูุฌุฉ**:
- `ComplaintHistory`: ุณุฌู ุชูุตููู ููุชุบููุฑ (ูููุณุชุฎุฏููู)
- `AuditEvent`: ุณุฌู ุงูุนูููุฉ (ูููุดุฑู)

---

## ๐ ูุซุงู ุนููู

### ุงูุณููุงุฑูู: ุชุบููุฑ ุญุงูุฉ ุดููู ูู PENDING ุฅูู IN_PROGRESS

**ComplaintHistory** (ูููุณุชุฎุฏููู):
```json
{
    "id": 1001,
    "complaint": {"id": 123},
    "actionType": "STATUS_CHANGED",
    "fieldChanged": "status",
    "oldValue": "PENDING",
    "newValue": "IN_PROGRESS",
    "actionDescription": "ุชู ุชุบููุฑ ุญุงูุฉ ุงูุดููู ูู 'ุฌุฏูุฏุฉ' ุฅูู 'ููุฏ ุงููุนุงูุฌุฉ' ุจูุงุณุทุฉ ุงูููุธู ุฃุญูุฏ ูุญูุฏ",
    "actor": {"id": 5, "name": "ุฃุญูุฏ ูุญูุฏ"},
    "createdAt": "2025-01-15T10:30:00"
}
```

**AuditEvent** (ูููุดุฑู):
```json
{
    "id": 5001,
    "action": "UPDATE_COMPLAINT",
    "targetType": "COMPLAINT",
    "targetId": 123,
    "actor": {"id": 5},
    "status": "SUCCESS",
    "details": "{\"statusChanged\": true, \"oldStatus\": \"PENDING\", \"newStatus\": \"IN_PROGRESS\"}",
    "ipAddress": "192.168.1.100",
    "createdAt": "2025-01-15T10:30:00"
}
```

**ุงููุฑู**:
- `ComplaintHistory`: **ูุฎุตุต ูููุณุชุฎุฏููู** - ูุตู ุจุงูุนุฑุจูุฉุ ุชูุงุตูู ุฏูููุฉ
- `AuditEvent`: **ูุฎุตุต ูููุดุฑู** - ุณุฌู ุฃูููุ IP address

---

## ๐ฏ ุงูุฎูุงุตุฉ

### โ **ุงูุงุญุชูุงุธ ุจูููููุง ูู ุงูุญู ุงูุฃูุซู**

**ุงูุฃุณุจุงุจ**:
1. โ **ูุตู ุงูุงูุชูุงูุงุช**: Domain-specific vs System-wide
2. โ **ุงุณุชุฎุฏุงู ูุฎุชูู**: User-facing vs Admin-facing
3. โ **ูููู ูุฎุชูู**: ุญููู ูุฎุตุตุฉ vs ูููู ุนุงู
4. โ **ุฃุฏุงุก ุฃูุถู**: ุฌุฏุงูู ูุญุณููุฉ ูููุตูุฉ
5. โ **ูุง ููุฌุฏ ุชูุฑุงุฑ ุญูููู**: ุชูุงุตูู vs ุนูููุงุช

**ุงูุชูุตูุฉ**:
- โ **ุงุญุชูุธ ุจู ComplaintHistory** ููุง ูู (ููุชูู ููุนูู ุจุดูู ููุชุงุฒ)
- โ **ุฃุถู AuditEvent** ููุนูููุงุช ุงูุฃุฎุฑู (ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏูููุ ุชุณุฌูู ุงูุฏุฎููุ ุฅูุฎ)
- โ **ุงุณุชุฎุฏู ูููููุง** ุญุณุจ ุงูุญุงุฌุฉ:
  - `ComplaintHistory` โ ูููุณุชุฎุฏููู (timeline)
  - `AuditEvent` โ ูููุดุฑู (ุชุฏููู)

---

## ๐ ููุงุญุธุงุช ุงูุชูููุฐ

### ุนูุฏ ุชุญุฏูุซ ุดููู:

```java
@Audited(action = "UPDATE_COMPLAINT", targetType = "COMPLAINT")
public ComplaintDTOResponse updateComplaint(...) {
    // ComplaintHistory: ุชูุงุตูู ุงูุชุบููุฑ (ููุฌูุฏ)
    complaintHistoryService.recordFieldUpdate(...);
    
    // AuditEvent: ุณุฌู ุงูุนูููุฉ (ูุชู ุชููุงุฆูุงู ุนุจุฑ @Audited)
    // ูุง ุญุงุฌุฉ ููุชุงุจุฉ ููุฏ ุฅุถุงูู
}
```

### ุนูุฏ ุฅูุดุงุก ููุธู:

```java
@Audited(action = "CREATE_EMPLOYEE", targetType = "EMPLOYEE")
public EmployeeResponseDTO addEmployee(...) {
    // AuditEvent ููุท (ูุง ููุฌุฏ ComplaintHistory ููุง)
    // ูุชู ุชููุงุฆูุงู ุนุจุฑ @Audited
}
```

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2025
**ุงููุฑุงุฑ**: ุงูุงุญุชูุงุธ ุจูููููุง (ComplaintHistory + AuditEvent)

